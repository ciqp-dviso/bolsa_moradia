<script>

  "use strict";

  /**
   * Variável para controlar o número de familiares do beneficiário
  */
  let numeroDeFamiliares;



  /**
   * Função que configura a página do bolsa moradia
   */
  function configurarPaginaBolsaMoradia() {

    // Esconde, inicialmente, os campos da página,
    // que só devem ser mostrados após a pesquisa
    document.getElementById( "navSuperior" ).style.display = "none";
    document.getElementById( "navInferior" ).style.display = "none";

    document.getElementById( "mensagemCadUnicoNaoLocalizado" ).style.display = "none";      
    
    document.getElementById( "dadosCadUnico" ).style.display = "none";
    document.getElementById( "dadosEncaminhamento" ).style.display = "none";
    document.getElementById( "dadosBeneficiario" ).style.display = "none";
    document.getElementById( "dadosFamilia" ).style.display = "none";

    document.getElementById( "bt_addFamiliar" ).style.display = "none";    

    document.getElementById( "assinatura_beneficiario" ).style.display = "none";    
    document.getElementById( "termoResponsabilidadeTecnico" ).style.display = "none";    


    // Reset no número de familiares
    numeroDeFamiliares = 0;

  } // Fim da função configurarPaginaBolsaMoradia



  /**
   * Handler para tratar o evento de click no botão pesquisa Cidadao
   */
  function handlerBotaoPesquisaCidadao() {

    // Reseta configuração da pagina Bolsa Moradia
    configurarPaginaBolsaMoradia();

    // Leitura do campo CPF
    let cpf = document.getElementById( "input_cpf" ).value;

    // Validação do CPF informado
    let cpfValidado = validarCPF( cpf );

    // Se CPF válido, o pesquisa na base do Cad Único
    if( cpfValidado != false ) {    

      // Mostra modal com mensagem de pesquisa pelo beneficiário
      mostrarModalMensagem( "Pesquisando beneficiário, por favor aguarde..." );                              

      // Pesquisa pelo CPF na base do Cad Único
      pesquisaCidadaoFE( cpfValidado );

    } // Fim da validação de RF           

  } // Fim da função handlerBotaoPesquisaCidadao



  /**
   * Função para validar o CPF informado pelo usuário
   */
  function validarCPF( cpf ) {
    
    // Testa se o CPF foi informado
    if( cpf == "" ) {   
      mostrarModalErro( "Campo CPF é obrigatório!" );
      return false;
    } 

    // Testa se foram informados os onze dígitos do CPF
    let caracteresCPF = cpf.split("");    
    let numDigitos = 0;

    let cpfProcessado = [];
    let digito;

    caracteresCPF.forEach( item => {

      digito = parseInt(item);
      if( !isNaN( digito ) ) {
        ++numDigitos;
        cpfProcessado.push( digito );
      }
    });

    if( numDigitos == 11 ) {
      return cpfProcessado.join("");
    } else {
      mostrarModalErro( "CPF inválido!" );      
      return false;
    }

  } // Fim da função validarCPF



  /**
   * Função para adicionar um familiar
   */
  function adicionarFamiliar() {
    
    // Incrementa o número de familiares do cidadão
    ++numeroDeFamiliares;

    // Mostra os campos dos familiares, se houver pelo menos 1 familiar
    if( numeroDeFamiliares == 1 ) {
      document.getElementById( "dadosFamilia" ).style.display = "";    
    }
    
    // Campos referentes a um familiar
    let familiar = `

        <!-- Familiar ${numeroDeFamiliares} - Início -->
        <div class="mb-5 p-4 bg-light border rounded-2" id="familiar_${numeroDeFamiliares}">

          <!-- Linha 1 - dados familiar -->
          <div class="row mb-1">       
            <div class="col-md-4">
              <label for="input_nome_familiar_${numeroDeFamiliares}" class="form-label fw-bold">NOME COMPLETO</label>
            </div>              
            <div class="col-md-2">
              <label for="input_dataNascimento_familiar_${numeroDeFamiliares}" class="form-label fw-bold">DATA DE NASCIMENTO</label>
            </div>            
            <div class="col-md-3">
              <label for="select_parentesco_familiar_${numeroDeFamiliares}" class="form-label fw-bold">PARENTESCO</label>
            </div>                                                 
            <div class="col-md-2">
              <label for="input_cpf_familiar_${numeroDeFamiliares}" class="form-label fw-bold">CPF</label>
            </div>                                                                             
            <div class="col-md-1"></div>        
          </div>    
      
          <div class="row mb-5">            
            <div class="col-md-4">
              <input type="text" class="form-control" id="input_nome_familiar_${numeroDeFamiliares}">
            </div>              
            <div class="col-md-2">
              <input type="date" class="form-control" id="input_dataNascimento_familiar_${numeroDeFamiliares}">
            </div>
            <div class="col-md-3">
              <select class="form-select" id="select_parentesco_familiar_${numeroDeFamiliares}">
                <?!= gerarSelect( BUFFER_PARENTESCO ); ?>
              </select>
            </div>   
            <div class="col-md-2">
              <input type="text" class="form-control" id="input_cpf_familiar_${numeroDeFamiliares}">
            </div>                                                                             
            <button type="button" class="btn btn-secondary col-md-1" onclick="removerFamiliar('familiar_${numeroDeFamiliares}')">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
              </svg>
            </button>                                  
          </div>                  


          <!-- Linha 2 - dados familiar -->
          <div class="row mb-1">       
            <div class="col-md-2">
              <label for="select_racaCor_familiar_${numeroDeFamiliares}" class="form-label fw-bold">RAÇA/COR</label>
            </div>              
            <div class="col-md-2">
              <label for="select_genero_familiar_${numeroDeFamiliares}" class="form-label fw-bold">GÊNERO</label>
            </div>            
            <div class="col-md-2">
              <label for="select_orientacaoSexual_familiar_${numeroDeFamiliares}" class="form-label fw-bold">ORIENTAÇÃO SEXUAL</label>
            </div>                         
            <div class="col-md-3">
              <label for="select_problemasSaude_familiar_${numeroDeFamiliares}" class="form-label fw-bold">PROBLEMAS DE SAÚDE</label>
            </div>                                                                             
            <div class="col-md-3"></div>        
          </div>    
      
          <div class="row mb-5">            
            <div class="col-md-2">
              <select class="form-select" id="select_racaCor_familiar_${numeroDeFamiliares}">
                <?!= gerarSelect( BUFFER_RACAS_CORES ); ?>
              </select>
            </div>                          
            <div class="col-md-2">
              <select class="form-select" id="select_genero_familiar_${numeroDeFamiliares}">
                <?!= gerarSelect( BUFFER_IDENTIDADES_DE_GENERO ); ?>
              </select>
            </div>
            <div class="col-md-2">
              <select class="form-select" id="select_orientacaoSexual_familiar_${numeroDeFamiliares}">
                <?!= gerarSelect( BUFFER_ORIENTACOES_SEXUAIS ); ?>
              </select>
            </div>   
            <div class="col-md-3">          
              <select class="form-select" id="select_problemasSaude_familiar_${numeroDeFamiliares}">
                <?!= gerarSelect( BUFFER_QUANTIDADE_PROBLEMAS_DE_SAUDE ); ?>
              </select>
            </div>               
            <div class="col-md-3"></div>        
          </div>    
          

          <!-- Linha 2.5 - dados familiar -->          
          <div class="row mb-5">          
            <div class="col-md-12">
              <input class="form-check-input border rounded-2 me-1" type="checkbox" value="1" id="checkbox_segundaRF_familiar_${numeroDeFamiliares}">              
              <label class="form-check-label fw-bold" for="checkbox_segundaRF_familiar_${numeroDeFamiliares}">
                2ª PESSOA RESPONSÁVEL PELA UNIDADE FAMILIAR - RF
              </label>                      
            </div>      
          </div>  

          
          <!-- Linha 3 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">ESSE FAMILIAR É PCD?</p>
            <div id="radiobutton_pcd_familiar_${numeroDeFamiliares}" onchange="mostrarCampo( 'pcd_familiar_${numeroDeFamiliares}', 'uploadArquivo_pcd_familiar_${numeroDeFamiliares}', '2', 'igualdade' )">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "pcd_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>            
    
          <div class="mb-5" id="uploadArquivo_pcd_familiar_${numeroDeFamiliares}" style="display: none;">
            <div class="row mb-1">
              <div class="col-md-12">
                <p class="fw-bold">INSIRA A DOCUMENTAÇÃO PCD</p>           
              </div>
            </div>
            <div class="row">
              <div class="col-md-5">            
                <input class="form-control" type="file" id="bt_uploadArquivo_pcd_familiar_${numeroDeFamiliares}">
              </div>
            </div>
          </div>                           
          
    
          <!-- Linha 4 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">DIAGNÓSTICO DE SOFRIMENTO MENTAL, USO PREJUDICIAL DE ÁLCOOL E DROGAS E/OU DEPENDENTES DE CUIDADOS PARA A VIDA DIÁRIA?</p>
            <div id="radiobutton_diagnostico_familiar_${numeroDeFamiliares}">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "diagnostico_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>
          
    
          <!-- Linha 5 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">MULHER EM GESTAÇÃO OU EM FASE DE PUERPÉRIO - ATÉ 6 MESES APÓS GESTAÇÃO?</p>
            <div id="radiobutton_gestacao_familiar_${numeroDeFamiliares}">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "gestacao_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>
          
    
          <!-- Linha 6 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">CRIANÇAS E/OU ADOLESCENTES COM MEDIDA PROTETIVA DE ACOLHIMENTO?</p>
            <div id="radiobutton_ceaMedidaProtetiva_familiar_${numeroDeFamiliares}">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "ceaMedidaProtetiva_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>      
    
    
          <!-- Linha 7 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">CRIANÇAS/ADOLESCENTES EM SITUAÇÃO DE TRABALHO INFANTIL E/OU EXPLORAÇÃO SEXUAL?</p>
            <div id="radiobutton_ceaTrabalhoExploracao_familiar_${numeroDeFamiliares}">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "ceaTrabalhoExploracao_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>            
    
            
          <!-- Linha 8 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">ESTÁ VINCULADO(A) AO TRABALHO FORMAL?</p>
            <div id="checkbox_trabalhoFormal_familiar_${numeroDeFamiliares}" onchange="mostrarCampo( 'trabalhoFormal_familiar_${numeroDeFamiliares}', 'uploadArquivo_trabalhoFormal_familiar_${numeroDeFamiliares}', '2', 'igualdade' )">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "trabalhoFormal_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>                     
          
          <div class="mb-5" id="uploadArquivo_trabalhoFormal_familiar_${numeroDeFamiliares}" style="display: none;">
            <div class="row mb-1">
              <div class="col-md-6">
                <p class="fw-bold">INSIRA O DOCUMENTO QUE COMPROVE O TRABALHO FORMAL</p>           
              </div>
            </div>
            <div class="row">
              <div class="col-md-5">            
                <input class="form-control" type="file" id="bt_uploadArquivo_trabalhoFormal_familiar_${numeroDeFamiliares}">
              </div>
            </div>
          </div>                           
    
          
          <!-- Linha 9 - dados familiar -->             
          <div class="row mb-4">
            <p class="fw-bold">ESTÁ VINCULADO(A) AO TRABALHO INFORMAL, GRUPOS PRODUTIVOS, ASSOCIAÇÕES E COOPERATIVAS?</p>
            <div id="checkbox_trabalhoInformal_familiar_${numeroDeFamiliares}" onchange="mostrarCampo( 'trabalhoInformal_familiar_${numeroDeFamiliares}', 'descricao_trabalhoInformal_familiar_${numeroDeFamiliares}', '1', 'diferenca' )">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarCheckBox( BUFFER_TIPOS_DE_TRABALHO, "trabalhoInformal_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>                     
          
          <div class="row mb-5" id="descricao_trabalhoInformal_familiar_${numeroDeFamiliares}" style="display: none;">
            <div class="col-md-10">
              <label for="textarea_descricao_trabalhoInformal_familiar_${numeroDeFamiliares}" class="form-label fw-bold mb-1">FAÇA UMA BREVE DESCRIÇÃO DO TRABALHO</label>
              <textarea class="form-control" id="textarea_descricao_trabalhoInformal_familiar_${numeroDeFamiliares}" rows="4" cols="50" maxlength="200" placeholder="Digite aqui a breve descrição"></textarea>
            </div>        
          </div>   
    
            
          <!-- Linha 10 - dados familiar  -->     
          <div class="row mb-3">
            <p class="fw-bold">É PARTICIPANTE DO PROGRAMA ESTAMOS JUNTOS, SEJA INSERIDO NAS FRENTES DE TRABALHO OU OPORTUNIDADE CLT?</p>
            <div id="radiobutton_estamosJuntos_familiar_${numeroDeFamiliares}" onchange="mostrarCampo( 'estamosJuntos_familiar_${numeroDeFamiliares}', 'uploadArquivo_estamosJuntos_familiar_${numeroDeFamiliares}', '2', 'igualdade' )">
              <!-- 1: checkbox inline   -->
              <!-- 0: checkbox vertical -->
              <?!= gerarRadioButton( BUFFER_RESPOSTAS_SIMPLES, "estamosJuntos_familiar_${numeroDeFamiliares}", 0 ); ?>
            </div>    
          </div>      
            
          <div class="mb-5" id="uploadArquivo_estamosJuntos_familiar_${numeroDeFamiliares}" style="display: none;">
            <div class="row mb-1">
              <div class="col-md-12">
                <p class="fw-bold">INSIRA A DECLARAÇÃO DA SUTE (Subsecretaria de Trabalho e Emprego) SOBRE A PARTICIPAÇÃO NO PROGRAMA ESTAMOS JUNTOS</p>           
              </div>
            </div>
            <div class="row">
              <div class="col-md-5">            
                <input class="form-control" type="file" id="bt_uploadArquivo_estamosJuntos_familiar_${numeroDeFamiliares}">
              </div>
            </div>
          </div>            

        </div>        
        <!-- Familiar - Fim -->    

    `;

    // Adiciona uma linha com campos referentes a um familiar
    document.getElementById("familiares").innerHTML += familiar;

  } // Fim da função adicionarFamiliar


  
  /**
   * Função para remover um familiar
   */
  function removerFamiliar( id ) {
   
    // Obtém o elemento pelo ID
    let elemento = document.getElementById( id );

    // Remove o elemento contendo os campos do familiar
    elemento.remove();

    // Decrementa o número de familiares do cidadão
    --numeroDeFamiliares;      
  
    // Esconde os campos dos familiares, se não houver mais familiares na lista
    if( numeroDeFamiliares == 0 ) {
      document.getElementById( "dadosFamilia" ).style.display = "none";    
    }

  } // Fim da função removerFamiliar


  /**
   * Função para mostrar, na página, um campo inicialmente invisível,
   * se o valor selecionado no componente de origem do evento for
   * igual ao parâmetro valorComparaçao
   * 
   * @param {String} nameComponenteOrigemEvento: Atributo name do elemento html onde
   *                                             o evento ocorreu;
   * @param {String} idElementoASerMostrado:  Atributo id do elemento html que será
   *                                          mostrado;
   * @param {String} valorComparacao:  Valor que será comparado com a opção
   *                                   selecionada. Se forem iguais, o elemento
   *                                   será mostrado. Caso contrário, será ocultado;
   * @param {String} operadorComparacao:  "igualdade" - para operador ==
   *                                      "diferenca" - para operados !=
   */
  function mostrarCampo( nameComponenteOrigemEvento,
                         idElementoASerMostrado,
                         valorComparacao,
                         operadorComparacao ) {

    // Reset nos displays dos campos
    document.getElementById( idElementoASerMostrado ).style.display = "none";
        
    // Ids das opcoes selecionadas
    const opcoesSelecionadas = document.querySelectorAll(`input[name=${nameComponenteOrigemEvento}]:checked`);
    const arrayIdsOpcoesSelecionadas = Array.from(opcoesSelecionadas).map(chk => chk.value);

    // Se algum checkbox dos tipos de trabalhos tiver sido selecionado
    if( arrayIdsOpcoesSelecionadas.length ) {

      arrayIdsOpcoesSelecionadas.forEach( item => {
        
        switch( operadorComparacao ) {

          case "igualdade":  if(item == valorComparacao) document.getElementById( idElementoASerMostrado ).style.display = "";        
                     break;
          case "diferenca":  if(item != valorComparacao) document.getElementById( idElementoASerMostrado ).style.display = "";        
                     break;          
        }

      }); 
    }

  } // Fim da função mostrarCampo




</script>








  