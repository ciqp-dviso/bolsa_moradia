<script>

  "use strict";

  // Informações do usuário logado no sistema
  let usuarioLogado = {};
  

  /**
   * Inicializa os sistema ao carregar a página index.html
   */
  document.addEventListener( 'DOMContentLoaded', () => {

    // Inicializa as telas modais
    inicializarModais();       
                   
    // Pŕe carrega as páginas do sistema no cache de páginas
    preCarregarPaginas();   
    
    // Mostra modal com mensagem de autenticação de usuário
    mostrarModalMensagem( "Autenticando o usuário, por favor aguarde..." );            

    // Tenta autenticar o usuário. 
    // Se autenticar, inicializa o sistema.
    // Se não, mostra mensagem de usuário não cadastrado
    google.script.run
                 .withSuccessHandler( usuario => {                     

                   // Atribui os dados do usuário autenticado
                   // ao objeto usuario
                   usuarioLogado = JSON.parse( usuario );

                   try {
               
                     // Se usuário autenticado com sucesso, inicializa o sistema.
                     if( usuarioLogado.id ) {
                   
                       // Mostra modal com mensagem de inicialização do sistema
                       mostrarModalMensagem( "Inicializando o sistema, por favor aguarde..." );                    
                   
                       // Aguarda os caches serem inicializados e em seguida chama 
                       // a função que redireciona para a tela com os resumos dos casos    
                       //setTimeout( function() { carregarPagina( "paginaBolsaMoradia" ); }, 10000 );  
                       carregarPagina( "paginaBolsaMoradia" );               

                     // Se usuário não autenticado, mostra mensagem de usuário não cadastrado.
                     } else {
               
                       // mostra modal com mensagem de gravação de dados
                       mostrarModalErro( "Usuário não cadastrado no sistema!" );           
               
                     }
               
                   } catch( error ) {
               
                     // mostra modal com mensagem de erro
                     // numa possível excessão
                     mostrarModalErro( error.message );    
               
                   } // Fim do try catch                        


                  })
                  // Se não conseguir obter informões do login
                  // do usuário, mostra mensagem de erro
                 .withFailureHandler( error => {

                   mostrarModalErro( error.message );

                  })
                  // Chama a função backend para autenticar o usuario
                 .autenticarUsuario();  
    

  }); // Fim do document.addEventListener


</script>