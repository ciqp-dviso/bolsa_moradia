<script>

  "use strict";

  // Cache das páginas do sistema, carregados via chamada 
  // da função backend include( "nomePagina" )
  let cachePaginaBolsaMoradia;


  // Flag que indica se a página inicial foi carregada
  //    0: ainda não foi carregada
  //    1: já foi carregada
  let flagPaginaInicialCarregada = 0;
  

  // timer
  const esperar = (time) => new Promise( ( resolve, reject ) => setTimeout( resolve, time ) );


  /**
   * Carrega dinamicamente uma página HTML no contêiner principal da aplicação.
   * 
   * @param {string} nomePagina - Nome do arquivo/página a ser carregado.
   *    
   * O sistema utiliza o modelo SPA (Single Page Application), em que a navegação ocorre 
   * dentro de uma única página base, carregando dinamicamente os conteúdos HTML
   * conforme a interação do usuário.
   * 
   * Fluxo:
   * 1. Substitui o conteúdo do elemento #conteudo pelo HTML informado.
   * 2. Chama a função apropriada para gerar o conteúdo dinâmico da página carregada    
   */   
  async function carregarPagina(nomePagina) {

    // Insere a página carregada no elemento de id Conteudo - SPA
    // e chama a função apropriada para gerar o conteudo dinâmico da páginacarregada
    switch( nomePagina ) {

      case "paginaBolsaMoradia": 
                              // Carrega a página resumosDosCasos.html, armazenada no cache do frontend,
                              // no elemento de id "conteudo" da página index.html (SPA)

                              while( !flagPaginaInicialCarregada ) {
                                console.log( "Aguardando carregamento da página na cache" );
                                await esperar( 1000 );
                              }
                              
                              document.getElementById("conteudo").innerHTML = cachePaginaBolsaMoradia;  

                              // Configura a página de resumos dos casos
                              window.scrollTo(0, 0);

                              // Gera a tabela de resumo dos casos                               
                              configurarPaginaBolsaMoradia();

                              break;

      default:                throw( new Error( "Página Inválida" ) );                               
                        
    } // Fim switch - case

    // Esconde modal de mensagem
    modalMensagem.hide();   


  } // Fim da função carregarPagina




  /**
   *  ########################################################
   *  #####                                              #####
   *  #####  Funções que inicializam o cache de páginas  #####
   *  #####                                              #####
   *  ########################################################
   */


  /**
  * Função que pré carrega todas as páginas do sistema para o cache de páginas
  */  
  function preCarregarPaginas() {
    
    carregarPaginaNaCache( "paginaBolsaMoradia" );

  } // Fim da função preCarregarPaginas



  /**
  * Função que carrega uma página do sistema para o cache de páginas
  *
  * @param {String} nomePagina - Nome da página que será carregada   
  */
  function carregarPaginaNaCache( nomePagina ) {

    google.script.run
                 .withSuccessHandler( pagina => {                     

                    // Atribui a página carregada ao cache apropriado
                    switch( nomePagina ) {
                      case "paginaBolsaMoradia":  cachePaginaBolsaMoradia = pagina;
                                                  flagPaginaInicialCarregada = 1;
                                                  break;                      
                      default:                    throw( new Error( "Página Inválida" ) ); 
                    }

                 })
                 .withFailureHandler( erro => {

                   // Mostra modal de erro
                   mostrarModalErro( "carregarPaginaNaCache - " + erro.message );

                 })
                 // Chama a função backend para carregar a tabela
                 .include( nomePagina );                                          

  } // Fim da função carregarPaginaNaCache
  
</script>